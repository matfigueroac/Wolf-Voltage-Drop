<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voltage Drop Calculator</title>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #eef1f5;
      margin: 0;
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f7f7f7;
    }
    input, select {
      padding: 5px;
      margin: 5px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .voltage-drop, .percentage-drop {
      width: 120px;
    }
    #addRowButton, #deleteLastRowButton, #exportButton {
      margin-left: 20px;
      padding: 5px 10px;
      background-color: #d9534f; /* Updated to reddish color */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #addRowButton:hover, #deleteLastRowButton:hover, #exportButton:hover {
      background-color: #c9302c; /* Darker shade for hover state */
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .content-container {
      padding: 0 20px;
    }
  </style>
</head>
<body>
  <div class="content-container">
    <h1 style="text-align: center;">Voltage Drop Calculator</h1>
    <div class="intro-section">
      <h2>Introduction</h2>
      <p>The voltage drop in a conductor can be calculated using the following equations:</p>
      <p>\[Vd = (2 \cdot K \cdot Q \cdot I \cdot D) / CM\] for single phase, and</p>
      <p>\[Vd = (1.732 \cdot K \cdot Q \cdot I \cdot D) / CM\] for three phase, where:</p>
      <ul>
        <li>\(Vd\) = Volts Dropped: The voltage drop of the circuit conductors as expressed in volts.</li>
        <li>\(K\) = Direct Current Constant: This is a constant that represents the direct current resistance for a one thousand circular mils conductor that is one thousand feet long, at an operating temperature of 75ยบ C. The direct current constant value to be used for copper is 12.9 ohms and 21.2 ohms is used for aluminum conductors. The "K" constant is suitable for alternating current circuits, where the conductors do not exceed No. 1/0.</li>
        <li>\(Q\) = Alternating Current Adjustment Factor: Alternating current circuits No. 2/0 and larger must be adjusted for the effects of self-induction (skin effect). The "Q" adjustment factor is determined by dividing alternating current resistance as listed in NEC Chapter 9, Table 9, by the direct current resistance as listed in Chapter 9, Table 8.</li>
        <li>\(I\) = Amperes: The load in amperes at 100 percent, not 125 percent for motors or continuous loads.</li>
        <li>\(D\) = Distance: The distance the load is located from the power supply, not the total length of the circuit conductors.</li>
        <li>\(CM\) = Circular-Mils: The circular mils of the circuit conductor as listed in Chapter 9, Table 8.</li>
      </ul>
    </div>

    <div class="main-container">
      <button id="deleteLastRowButton" onclick="deleteLastRow()">Delete Last Row</button>
      <button id="addRowButton" onclick="addRow()">Add Row</button>
      <button id="exportButton" onclick="exportTableToCSV('voltage_drop_calculations.csv')">Export to CSV</button>
      <table id="calculationTable">
        <thead>
          <tr>
            <th>Path Name</th>
            <th>Material (K)</th>
            <th>Power Factor (Q)</th>
            <th>Current (I) in Amperes</th>
            <th>Circuit Distance (D) in Feet</th>
            <th>Wire Size</th>
            <th>System Voltage</th>
            <th>Phase</th>
            <th>Voltage Drop (V)</th>
            <th>Percentage (%)</th>
          </tr>
        </thead>
        <tbody>



  
  <script>
    const wireSizes = {
      "14 AWG": 4115, "12 AWG": 6530, "10 AWG": 10380, "8 AWG": 16510,
      "6 AWG": 26240, "4 AWG": 41740, "3 AWG": 52620, "2 AWG": 66360,
      "1 AWG": 83690, "1/0 AWG": 105600, "2/0 AWG": 133100, "3/0 AWG": 167800,
      "4/0 AWG": 211600, "250 kcmil": 250000, "300 kcmil": 300000,
      "350 kcmil": 350000, "400 kcmil": 400000, "500 kcmil": 500000,
      "600 kcmil": 600000, "700 kcmil": 700000, "750 kcmil": 750000,
      "800 kcmil": 800000, "900 kcmil": 900000, "1000 kcmil": 1000000,
      "1250 kcmil": 1250000, "1500 kcmil": 1500000, "1750 kcmil": 1750000,
      "2000 kcmil": 2000000
    };

    function populateWireSizeDropdowns() {
      document.querySelectorAll('.wireSize').forEach(select => {
        Object.entries(wireSizes).forEach(([size, cm]) => {
          const option = document.createElement('option');
          option.value = cm;
          option.textContent = size;
          select.appendChild(option);
        });
      });
    }

    function calculateRow(row) {
      const k = parseFloat(row.cells[1].getElementsByTagName('select')[0].value);
      const q = parseFloat(row.cells[2].getElementsByTagName('input')[0].value || 1);
      const i = parseFloat(row.cells[3].getElementsByTagName('input')[0].value || 0);
      const d = parseFloat(row.cells[4].getElementsByTagName('input')[0].value || 0);
      const cm = parseFloat(row.cells[5].getElementsByTagName('select')[0].value);
      const voltage = parseFloat(row.cells[6].getElementsByTagName('input')[0].value || 0);
      const phase = row.cells[7].getElementsByTagName('select')[0].value;

      let voltageDrop = phase === 'single' ? (2 * k * q * i * d) / cm : (1.732 * k * q * i * d) / cm;
      let voltageDropPercentage = (voltageDrop / voltage) * 100;

      row.cells[8].textContent = voltageDrop.toFixed(2) + ' V';
      row.cells[9].textContent = !isFinite(voltageDropPercentage) ? "-" : voltageDropPercentage.toFixed(2) + '%';
    }

    function validateInput(input) {
      if (input.value < 0) {
        input.value = 0;
        input.classList.add('error');
        input.setCustomValidity('Please enter a positive number.');
      } else {
        input.classList.remove('error');
        input.setCustomValidity('');
      }
    }

    function addRow() {
      const table = document.getElementById('calculationTable').getElementsByTagName('tbody')[0];
      const newRow = table.insertRow();
      const cellStructure = `
        <td><input type="text" placeholder="Path Name"></td>
        <td><select onchange="calculateRow(this.parentElement.parentElement)">
              <option value="12.9">Copper</option>
              <option value="21.2">Aluminum</option>
            </select></td>
        <td><input type="number" value="1" step="any" onchange="calculateRow(this.parentElement.parentElement)" placeholder="Q"></td>
        <td><input type="number" step="any" min="0" oninput="validateInput(this)" onchange="calculateRow(this.parentElement.parentElement)" placeholder="I"></td>
        <td><input type="number" step="any" min="0" oninput="validateInput(this)" onchange="calculateRow(this.parentElement.parentElement)" placeholder="D"></td>
        <td><select class="wireSize" onchange="calculateRow(this.parentElement.parentElement)"></select></td>
        <td><input type="number" step="any" min="0" oninput="validateInput(this)" onchange="calculateRow(this.parentElement.parentElement)" placeholder="Voltage"></td>
        <td><select onchange="calculateRow(this.parentElement.parentElement)">
              <option value="three">Three</option>
              <option value="single">Single</option>
           
            </select></td>
        <td class="voltage-drop"></td>
        <td class="percentage-drop"></td>
      `;
      newRow.innerHTML = cellStructure;
      populateWireSizeDropdowns();
    }

    function deleteLastRow() {
      const table = document.getElementById('calculationTable').getElementsByTagName('tbody')[0];
      if (table.rows.length > 0) {
        table.deleteRow(table.rows.length - 1);
      }
    }

    function exportTableToCSV(filename) {
      let csv = [];
      const rows = document.querySelectorAll("#calculationTable tr");

      for (let i = 0; i < rows.length; i++) {
        const row = [], cols = rows[i].querySelectorAll("td, th");
        
        for (let j = 0; j < cols.length; j++) {
          if (cols[j].querySelector('input')) {
            const input = cols[j].querySelector('input');
            row.push('"' + input.value.replace(/"/g, '""') + '"');
          } else if (cols[j].querySelector('select')) {
            const select = cols[j].querySelector('select');
            row.push('"' + select.options[select.selectedIndex].text.replace(/"/g, '""') + '"');
          } else {
            row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
          }
        }
        
        csv.push(row.join(","));
      }

      downloadCSV(csv.join("\n"), filename);
    }

    function downloadCSV(csv, filename) {
      const csvFile = new Blob([csv], {type: "text/csv"});
      const downloadLink = document.createElement("a");

      downloadLink.download = filename;
      downloadLink.href = window.URL.createObjectURL(csvFile);
      downloadLink.style.display = "none";

      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    }

    document.addEventListener('DOMContentLoaded', () => {
      addRow(); // Add an initial row
    });
  </script>
</body>
</html>
